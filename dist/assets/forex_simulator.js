const{Application:yt,Graphics:b,Text:m,Container:v,Sprite:vt,Assets:Bt,BlurFilter:Ht}=PIXI,G=io(),gt="user-"+Math.floor(Math.random()*1e6),Ct=200;async function mt(){const rt=document.getElementById("forexSimulatorCanvas"),D=4/3;let B=Math.min(window.innerWidth,980),H=B/D;H>Math.min(window.innerHeight,735)&&(H=Math.min(window.innerHeight,735),B=H*D);const S=new yt;await S.init({canvas:rt,background:"#2e2e2e",width:B,height:H});const N=5,a=B*.85,r=H*.75,c=new v;c.x=N,c.y=N,S.stage.addChild(c);const X=new b;X.rect(0,0,a,r).fill(16777215),c.addChild(X),c.mask=X;const j=new b;j.rect(0,0,a,r).stroke({width:2,color:4473924}),c.addChild(j);const W=new b;c.addChild(W);const k=new v;c.addChild(k);const p=[];let dt=0,d=r/2,w=1e3,q=d,J=w;const $=8,K=4,ht=800,Q=a*.25,xt=-50,pt=a+50,U=40,h=[];let T=0,L=d,O=1e3,P=0,V=0;const Z=new v;S.stage.addChild(Z);const tt=8,et=120,wt=40;let y=1e3;const nt=new b;nt.roundRect(0,0,et,wt,6).fill({color:0,alpha:.7}).stroke({width:1,color:16777215,alpha:.3});const I=new m({text:`Balance: ${y}`,style:{fill:"#fff",fontSize:16,fontFamily:"Arial",fontWeight:"bold"}});I.x=10,I.y=10;const R=new v;R.addChild(nt,I),Z.addChild(R),R.x=B-et-tt,R.y=2*tt;const A=new v;c.addChild(A);const M=new b;A.addChild(M);const x=new m({text:O.toFixed(2),style:{fill:"#fff",fontSize:14,fontFamily:"Arial",fontWeight:"bold"}});x.anchor.set(0,.5),A.addChild(x);const z=new m({text:w.toFixed(2),style:{fill:"#ccc",fontSize:12,fontFamily:"Arial"}});z.anchor.set(1,.5),c.addChild(z);const ot=new v;S.stage.addChild(ot);const Y=100,lt=40,it=40;function at(e,n){const t=new v,s=new b;s.roundRect(0,0,Y,lt,6).fill({color:n}).stroke({width:2,color:16777215,alpha:.3});const i=new m({text:e,style:{fill:"#fff",fontSize:16,fontWeight:"bold",fontFamily:"Arial"}});return i.anchor.set(.5),i.x=Y/2,i.y=lt/2,t.addChild(s,i),t.eventMode="static",t.cursor="pointer",t.bg=s,t.txt=i,t}const F=at("LOW",14242639),_=at("HIGH",6076508),ct=H*.8;F.x=B/2-Y-it/2,F.y=ct,_.x=F.x+20+Y+it,_.y=ct,ot.addChild(F,_);function ut(){W.moveTo(0,d).lineTo(a,d).stroke({width:1,color:5592405}),z.x=a-4,z.y=d,z.text=w.toFixed(2)}function bt(){W.clear(),ut();const e=[];for(const n of h){const t=n.x-P;t>xt&&t<pt&&n.y>=0&&n.y<=r&&e.push(t,n.y)}if(e.length>=4&&W.poly(e,!1).stroke({width:2,color:65280}),h.length>1){const n=h[h.length-1],t=n.x-P,s=n.y;t>=0&&t<=a&&s>=0&&s<=r&&W.circle(t,s,3).fill({color:65280})}if(h.length){x.text=O.toFixed(2),x.x=4,x.y=0;const n=6,t=4,s=x.width,i=x.height,E=x.width;x.height,M.clear(),M.roundRect(0,-i/2-t/2,s+n*2,i+t,4),M.fill({color:0,alpha:.7}),M.stroke({color:16777215,width:1,alpha:.3}),A.x=a-(E+n*2)-8,A.y=18,k.removeChildren();for(const f of p){const o=d-(f.price-w)*$;if(o<0||o>r)continue;const g=new b;g.moveTo(0,o).lineTo(a,o).stroke({width:1,color:f.color,alpha:.6}),k.addChild(g);const l=new m({text:`${f.type} ${f.price.toFixed(2)}`,style:{fill:"#fff",fontSize:12,fontFamily:"Arial"}});l.anchor.set(1,.5),l.x=a-5,l.y=o+5,l.alpha=f.alpha,k.addChild(l)}for(const f of p){const o=f.xTarget-P;if(o<0||o>a)continue;const g=0,l=r,C=new b;C.moveTo(o,g).lineTo(o,l).stroke({width:1,color:f.color,alpha:.4}),k.addChild(C);const u=new m({text:"â±",style:{fill:"#fff",fontSize:12}});u.anchor.set(.5),u.x=o,u.y=10,u.alpha=.5,k.addChild(u)}}}S.ticker.add(()=>{P+=(V-P)*.2;const n=.04;d+=(q-d)*n,w+=(J-w)*n;for(const t of h)t.y=d-(t.price-w)*$;for(const t of p)!t.active&&t.alpha>0&&(t.alpha-=.02);bt();for(let t=p.length-1;t>=0;t--)p[t].alpha<=0&&p.splice(t,1)}),G.on("forex_update",e=>{O=e.value,T+=K,L=d-(e.value-w)*$,h.push({x:T,y:L,price:e.value}),h.length>ht&&h.shift(),(L<U||L>r-U)&&(J=e.value,q=r/2),T>Q?V=T-Q:V=0}),G.on("bet_result",e=>{const{type:n,entryPrice:t,finalPrice:s,win:i}=e;i&&(y+=2,I.text=`Balance: ${y}`);const E=i?65280:16711680,f=i?"WIN":"LOSE";let o=null,g=1/0;for(const C of p)if(C.active&&C.type===n){const u=Math.abs(C.price-t);u<g&&(g=u,o=C)}o&&(o.active=!1,o.color=E);const l=new m({text:f,style:{fill:i?"#00ff00":"#ff3333",fontSize:20,fontWeight:"bold",fontFamily:"Arial"}});l.anchor.set(.5),l.x=a/2,l.y=r/2,l.alpha=1,c.addChild(l),S.ticker.add(()=>{l.alpha-=.02,l.alpha<=0&&c.removeChild(l)})});let st;G.on("forex_update",e=>{st=e.value});function ft(e){if(y<=0)return;y-=1,I.text=`Balance: ${y}`;const n={userId:gt,type:e,entryPrice:st,balance:y};G.emit("place_bet",n);const t=Ct,s=T,i=T+t*K,E=++dt,f=e==="HIGH"?65280:16711680;p.push({id:E,price:O,color:f,type:e,active:!0,alpha:1,xStart:s,xTarget:i});const o=e==="HIGH"?_:F;o.bg.tint=16776960,setTimeout(()=>o.bg.tint=16777215,200)}F.on("pointertap",()=>ft("LOW")),_.on("pointertap",()=>ft("HIGH"))}mt();
