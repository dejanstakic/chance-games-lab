const{Application:ke,Graphics:E,Text:h,Container:g}=PIXI,ve=[[3.84],[2.1,3.3],[1.3,2.5,3.9],[1,1.7,3,4.4],[.8,1,2.5,3.5,6.4],[.4,.8,2,3,5,7.2],[.2,.5,1.5,2.5,4,5.5,12],[0,.4,1,2,3,3.7,8,20],[0,0,.8,1.2,2,3,4.6,12,40],[0,0,0,1,1.5,2,3,6,20,60]];async function Ne(){const Z=document.getElementById("kenoStopBallCanvas"),he=4/3;let q=Math.min(window.innerWidth,980),I=q/he;I>Math.min(window.innerHeight,735)&&(I=Math.min(window.innerHeight,735),q=I*he);const We=()=>({width:q,height:I}),t=new ke;await t.init({canvas:Z,background:"#333333"});let i,u,we,y,L,f,e,O=1e3;const Q=new g,U=new g,l=new g,$=new g;t.stage.addChild($,Q,l,U);const w=[],W=[],Y=new h({text:`Balance: ${O.toFixed(2)}`,style:{fill:16777215,fontSize:28}});Y.anchor.set(1,0),$.addChild(Y);const R=new h({text:"ⓘ INFO",style:{fill:16777215,fontSize:28,fontWeight:"bold",cursor:"pointer"}});R.anchor.set(0,0),R.position.set(20,20),R.eventMode="static",R.cursor="pointer",$.addChild(R);const H=new h({text:`Bet: 1
Win: 
Hits: `,style:{fill:16776960,fontSize:28}});H.anchor.set(0,0),$.addChild(H);const j=new g;$.addChild(j);const C=new g;C.visible=!1,t.stage.addChild(C);const ue=new E().rect(0,0,t.renderer.width,t.renderer.height).fill({color:0,alpha:.8});C.addChild(ue);const A=t.renderer.width*.8,b=t.renderer.height*.7,pe=new E().roundRect((t.renderer.width-A)/2,(t.renderer.height-b)/2,A,b,16).fill({color:2236996});C.addChild(pe);const T=new h({text:`
KENO STOP SHOT
• RTP: 96.12%
• Select up to 10 numbers.
• Press PLAY to start the draw.
• Match numbers to win based on the paytable.
• Your balance decreases by 1 per play.
• Winnings are shown on the right.

Good luck!!
  `,style:{fill:16777215,fontSize:24,wordWrap:!0,wordWrapWidth:A*.9,lineHeight:36}});T.anchor.set(.5,0),T.position.set(t.renderer.width/2,(t.renderer.height-b)/2+50),C.addChild(T);const S=new h({text:"✖ CLOSE",style:{fill:16729156,fontSize:28,fontWeight:"bold",cursor:"pointer"}});S.anchor.set(.5),S.position.set(t.renderer.width/2,(t.renderer.height+b)/2-40),S.eventMode="static",S.cursor="pointer",C.addChild(S),R.on("pointerdown",()=>{C.visible=!0}),S.on("pointerdown",()=>{C.visible=!1});function V(){Y.text=`Balance: ${O.toFixed(2)}`,Y.position.set(i-20,20)}function Re(){const m=(i+L)/2+e/4,k=y;H.position.set(m,k)}function D(){j.removeChildren();const m=w.length;if(m===0||m>ve.length)return;const k=ve[m-1],G={fill:16777215,fontSize:f*.04},B=f*.06;k.forEach((ee,_)=>{const te=`Hit ${(_+1).toString()}`,X=new h({text:`${te}: ${ee.toFixed(2)}x`,style:G});X.anchor.set(0,1),X.position.set(0,-_*B),j.addChild(X)});const z=(i+L)/2+e/4,v=y+f*.9;j.position.set(z,v)}function xe(){const{width:m,height:k}=We(),G=4/3;i=m,u=m/G,u>k&&(u=k,i=u*G),t.renderer.resize(i,u),Z.style.display="block",Z.style.margin="0 auto",Q.removeChildren(),U.removeChildren(),l.removeChildren();const B=5,z=8,v=8;L=i*.6,f=u*.6;const ee=(L-(z-1)*v)/z,_=(f-(B-1)*v)/B;e=Math.min(ee,_);const te=z*e+(z-1)*v,X=B*e+(B-1)*v;we=(i-te)/2,y=.6*(u-X),W.length=0;for(let r=0;r<B;r++)for(let n=0;n<z;n++){const a=r*z+n+1,s=new g;s.x=we+n*(e+v),s.y=y+r*(e+v),s.eventMode="static",s.cursor="pointer";const p=new E().roundRect(0,0,e,e,10).fill({color:5592405});s.addChild(p);const o=new h({text:a.toString(),style:{fill:16777215,fontSize:e*.4}});o.anchor.set(.5),o.position.set(e/2,e/2),s.addChild(o),s.on("pointerdown",()=>{const c=w.indexOf(a);if(c===-1){if(w.length>=10)return;w.push(a),p.clear().roundRect(0,0,e,e,10).fill({color:16729156}),D()}else w.splice(c,1),p.clear().roundRect(0,0,e,e,10).fill({color:5592405}),D()}),Q.addChild(s),W.push({number:a,bg:p})}w.forEach(r=>{const n=W.find(a=>a.number===r);n&&(n.bg.clear(),n.bg.roundRect(0,0,e,e,10).fill({color:16729156}))}),T.style.fontSize=f*.05,T.style.lineHeight=f*.05*1.2,S.style.fontSize=f*.05,R.style.fontSize=f*.05,Y.style.fontSize=f*.05,Y.position.set(i-20,20),H.style.fontSize=f*.05;const He=(i+L)/2+e/4,Te=y;H.position.set(He,Te),l.removeChildren();const N=6,d=e*.6,ne=14,oe=20,ie=15,Be=3,ge=ne*(d+N)-N+oe*2,le=Be*(d+N)-N+ie*2,Me=u*.01,re=(i-ge)/2;let M=y-le-Me;const ye=u*.02;M<ye&&(M=ye);const se=new E().roundRect(0,0,ge,le,12).fill({color:2236996});se.alpha=.7,se.position.set(re,M),l.addChild(se);const ce=new h({text:"",style:{fill:16777215,fontSize:d*.5}});ce.anchor.set(.5),ce.position.set(i/2,M-d*.4),l.addChild(ce);const J=new h({text:"Waiting for draw...",style:{fill:11184810,fontSize:d*.5,fontStyle:"italic"}});J.anchor.set(.5),J.position.set(i/2,M+le/2),J.label="placeholder",l.addChild(J);const K=i*.25,de=u*.07,Ce=y+f,be=i*.1;function Se(r,n,a){const s=new g,p=new E().roundRect(-K/2,-de/2,K,de,12).fill({color:n});s.addChild(p);const o=new h({text:r,style:{fill:16777215,fontSize:de*.5}});return o.anchor.set(.5),s.addChild(o),s.eventMode="static",s.cursor="pointer",s.on("pointerdown",async()=>{p.tint=21964,await a(),p.tint=16777215,p.tint=n}),s}const P=Se("PLAY",30719,async()=>{if(!(O<=0)){if(w.length===0){l.children.length>2&&l.removeChildren(2,l.children.length);const r=new h({text:"Select at least one number!",style:{fill:16733525,fontSize:24}});r.anchor.set(.5),r.position.set(i/2,.5*y),l.addChild(r);return}P.eventMode="none",P.alpha=.5,O-=1,V();try{const n=await(await fetch("/api/keno_stop_ball/play",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({selected:w,balance:O})})).json();W.forEach(({number:o,bg:c})=>{c.clear(),c.roundRect(0,0,e,e,10).fill({color:5592405}),w.includes(o)&&(c.clear(),c.roundRect(0,0,e,e,10).fill({color:16729156}))});const a=l.children.find(o=>o.label==="placeholder");a&&(a.visible=!1),l.children.length>2&&l.removeChildren(2,l.children.length);const s=re+oe,p=M+ie;for(let o=0;o<n.drawnNumbers.length;o++){const c=n.drawnNumbers[o],Pe=Math.floor(o/ne),Ee=o%ne,Oe=re+oe+Ee*(d+N),Ye=M+ie+Pe*(d+N),x=new g;x.x=Oe,x.y=Ye;const me=n.winningNumbers.includes(c),ze=me?65280:16763904;if(o<n.drawnNumbers.length-1){const F=new E().roundRect(0,0,d,d,8).fill({color:ze});x.addChild(F);const fe=new h({text:c.toString(),style:{fill:0,fontSize:d*.4}});fe.anchor.set(.5),fe.position.set(d/2,d/2),x.addChild(fe),l.addChild(x)}else{const F=new E().roundRect(0,0,d,d,8).fill({color:0}).stroke({color:ze,width:6});x.addChild(F),l.addChild(x)}x.scale.set(0),gsap.to(x.scale,{x:1,y:1,duration:.3,ease:"back.out(1.7)"}),me&&W[c-1].bg.stroke({color:65280,width:6}),await new Promise(F=>setTimeout(F,1e3))}H.text=`Bet: 1
Win: ${n.win}
Hits: ${n.hits}`,O=n.balance,V(),setTimeout(()=>{W.forEach(({number:o,bg:c})=>{c.clear(),c.roundRect(0,0,e,e,10).fill({color:5592405}),w.includes(o)&&(c.clear(),c.roundRect(0,0,e,e,10).fill({color:16729156}))}),P.eventMode="static",P.alpha=1,H.text=`Bet: 1
Win: 
Hits:  `,a&&(a.visible=!0)},1e3)}catch{}}}),ae=Se("CLEAR",16729156,async()=>{w.length=0,W.forEach(({bg:r})=>r.clear().roundRect(0,0,e,e,10).fill({color:5592405})),D()});ue.clear().rect(0,0,t.renderer.width,t.renderer.height).fill({color:0,alpha:.8}),pe.clear().roundRect((t.renderer.width-A)/2,(t.renderer.height-b)/2,A,b,16).fill({color:2236996}),T.style.wordWrapWidth=t.renderer.width*.7,T.position.set(t.renderer.width/2,(t.renderer.height-b)/2+50),S.position.set(t.renderer.width/2,(t.renderer.height+b)/2-40),P.x=i/2-K/2-be/2,P.y=Ce,ae.x=i/2+K/2+be/2,ae.y=Ce,U.addChild(P,ae),V(),Re(),D()}xe(),window.addEventListener("resize",xe)}Ne();
