const{Application:Ee,Graphics:Y,Text:f,Container:u}=PIXI,be=[[3.88],[1.7,5.5],[1,3,10],[.5,2,8,36],[.25,1,4,24,100],[0,.5,3,12,60,300],[0,.25,2.5,5,27,150,500],[0,0,2,4,12,45,250,700],[0,0,1.5,2.5,8,20,200,500,850],[0,0,1,2,5,12,150,300,700,1e3]];async function Pe(){const K=document.getElementById("kenoBasicCanvas"),re=4/3;let Z=Math.min(window.innerWidth,980),X=Z/re;X>Math.min(window.innerHeight,735)&&(X=Math.min(window.innerHeight,735),Z=X*re);const Se=()=>({width:Z,height:X}),t=new Ee;await t.init({canvas:K,background:"#333333"});let n,x,se,g,O,a,e,T=1e3;const _=new u,q=new u,o=new u,A=new u;t.stage.addChild(A,_,o,q);const h=[],E=[],P=new f({text:`Balance: ${T}`,style:{fill:16777215,fontSize:28}});P.anchor.set(1,0),A.addChild(P);const v=new f({text:"ⓘ INFO",style:{fill:16777215,fontSize:28,fontWeight:"bold",cursor:"pointer"}});v.anchor.set(0,0),v.position.set(20,20),v.eventMode="static",v.cursor="pointer",A.addChild(v);const W=new f({text:`Bet: 1
Win: 
Hits: `,style:{fill:16776960,fontSize:28}});W.anchor.set(0,0),A.addChild(W);const k=new u;A.addChild(k);const y=new u;y.visible=!1,t.stage.addChild(y);const ce=new Y().rect(0,0,t.renderer.width,t.renderer.height).fill({color:0,alpha:.8});y.addChild(ce);const L=t.renderer.width*.8,C=t.renderer.height*.7,de=new Y().roundRect((t.renderer.width-L)/2,(t.renderer.height-C)/2,L,C,16).fill({color:2236996});y.addChild(de);const R=new f({text:`
KENO BASIC

• RTP: 95%
• Select up to 10 numbers.
• Press PLAY to start the draw.
• Match numbers to win based on the paytable.
• Your balance decreases by 1 per play.
• Winnings are shown on the right.
  `,style:{fill:16777215,fontSize:24,wordWrap:!0,wordWrapWidth:L*.9,lineHeight:36}});R.anchor.set(.5,0),R.position.set(t.renderer.width/2,(t.renderer.height-C)/2+50),y.addChild(R);const b=new f({text:"✖ CLOSE",style:{fill:16729156,fontSize:28,fontWeight:"bold",cursor:"pointer"}});b.anchor.set(.5),b.position.set(t.renderer.width/2,(t.renderer.height+C)/2-40),b.eventMode="static",b.cursor="pointer",y.addChild(b),v.on("pointerdown",()=>{y.visible=!0}),b.on("pointerdown",()=>{y.visible=!1});function Q(){P.text=`Balance: ${T}`,P.position.set(n-20,20)}function ze(){const S=(n+O)/2+e/4,M=g;W.position.set(S,M)}function I(){k.removeChildren();const S=h.length;if(S===0||S>be.length)return;const M=be[S-1],j={fill:16777215,fontSize:a*.04},B=a*.06;M.forEach((U,F)=>{const V=`Hit ${(F+1).toString()}`,N=new f({text:`${V}: ${U.toFixed(2)}x`,style:j});N.anchor.set(0,1),N.position.set(0,-F*B),k.addChild(N)});const z=(n+O)/2+e/4,m=g+a*.9;k.position.set(z,m)}function ae(){const{width:S,height:M}=Se(),j=4/3;n=S,x=S/j,x>M&&(x=M,n=x*j),t.renderer.resize(n,x),K.style.display="block",K.style.margin="0 auto",_.removeChildren(),q.removeChildren(),o.removeChildren();const B=5,z=8,m=8;O=n*.6,a=x*.6;const U=(O-(z-1)*m)/z,F=(a-(B-1)*m)/B;e=Math.min(U,F);const V=z*e+(z-1)*m,N=B*e+(B-1)*m;se=(n-V)/2,g=(x-N)/2,E.length=0;for(let r=0;r<B;r++)for(let i=0;i<z;i++){const d=r*z+i+1,l=new u;l.x=se+i*(e+m),l.y=g+r*(e+m),l.eventMode="static",l.cursor="pointer";const p=new Y().roundRect(0,0,e,e,10).fill({color:5592405});l.addChild(p);const s=new f({text:d.toString(),style:{fill:16777215,fontSize:e*.4}});s.anchor.set(.5),s.position.set(e/2,e/2),l.addChild(s),l.on("pointerdown",()=>{const c=h.indexOf(d);if(c===-1){if(h.length>=10)return;h.push(d),p.clear().roundRect(0,0,e,e,10).fill({color:16729156}),I()}else h.splice(c,1),p.clear().roundRect(0,0,e,e,10).fill({color:5592405}),I()}),_.addChild(l),E.push({number:d,bg:p})}h.forEach(r=>{const i=E.find(d=>d.number===r);i&&(i.bg.clear(),i.bg.roundRect(0,0,e,e,10).fill({color:16729156}))}),R.style.fontSize=a*.05,R.style.lineHeight=a*.05*1.2,b.style.fontSize=a*.05,v.style.fontSize=a*.05,P.style.fontSize=a*.05,P.position.set(n-20,20),W.style.fontSize=a*.05;const me=(n+O)/2+e/4,ve=g;W.position.set(me,ve),o.removeChildren();const fe=6,w=e*.7,he=10,We=he*w+(he-1)*fe,we=20,pe=15,ue=We+we*2,ee=w+pe*2,xe=(n-ue)/2,D=.65*g-ee/2,te=new Y().roundRect(0,0,ue,ee,12).fill({color:2236996});te.alpha=.7,te.position.set(xe,D),o.addChild(te);const ne=new f({text:"",style:{fill:16777215,fontSize:w*.5}});ne.anchor.set(.5),ne.position.set(n/2,D-w*.4),o.addChild(ne);const G=new f({text:"Waiting for draw...",style:{fill:11184810,fontSize:w*.5,fontStyle:"italic"}});G.anchor.set(.5),G.position.set(n/2,D+ee/2),G.label="placeholder",o.addChild(G);const J=n*.25,oe=x*.08,ge=g+a*1.05,ye=n*.1;function Ce(r,i,d){const l=new u,p=new Y().roundRect(-J/2,-oe/2,J,oe,12).fill({color:i});l.addChild(p);const s=new f({text:r,style:{fill:16777215,fontSize:oe*.5}});return s.anchor.set(.5),l.addChild(s),l.eventMode="static",l.cursor="pointer",l.on("pointerdown",async()=>{p.tint=21964,await d(),p.tint=16777215,p.tint=i}),l}const H=Ce("PLAY",30719,async()=>{if(!(T<=0)){if(h.length===0){o.children.length>2&&o.removeChildren(2,o.children.length);const r=new f({text:"Select at least one number!",style:{fill:16733525,fontSize:24}});r.anchor.set(.5),r.position.set(n/2,.5*g),o.addChild(r);return}H.eventMode="none",H.alpha=.5,T-=1,Q();try{const i=await(await fetch("/api/keno_basic/play",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({selected:h,balance:T})})).json();E.forEach(({number:s,bg:c})=>{c.clear(),c.roundRect(0,0,e,e,10).fill({color:5592405}),h.includes(s)&&(c.clear(),c.roundRect(0,0,e,e,10).fill({color:16729156})),i.winningNumbers.includes(s)&&c.stroke({color:65280,width:6})});const d=o.children.find(s=>s.label==="placeholder");d&&(d.visible=!1),o.children.length>2&&o.removeChildren(2,o.children.length);const l=xe+we,p=D+pe;i.drawnNumbers.forEach((s,c)=>{const Re=l+c*(w+fe),Be=p,$=new u;$.x=Re,$.y=Be;const He=i.winningNumbers.includes(s)?65280:16763904,Te=new Y().roundRect(0,0,w,w,8).fill({color:He});$.addChild(Te);const le=new f({text:s.toString(),style:{fill:0,fontSize:w*.4}});le.anchor.set(.5),le.position.set(w/2,w/2),$.addChild(le),o.addChild($)}),W.text=`Bet: 1
Win: ${i.win}
Hits: ${i.hits}`,T=i.balance.toFixed(2),Q(),setTimeout(()=>{o.children.length>2&&o.removeChildren(2,o.children.length),E.forEach(({number:s,bg:c})=>{c.clear(),c.roundRect(0,0,e,e,10).fill({color:5592405}),h.includes(s)&&(c.clear(),c.roundRect(0,0,e,e,10).fill({color:16729156}))}),H.eventMode="static",H.alpha=1,W.text=`Bet: 1
Win: 
Hits:  `,d&&(d.visible=!0)},1500)}catch{}}}),ie=Ce("CLEAR",16729156,async()=>{h.length=0,E.forEach(({bg:r})=>r.clear().roundRect(0,0,e,e,10).fill({color:5592405})),I()});ce.clear().rect(0,0,t.renderer.width,t.renderer.height).fill({color:0,alpha:.8}),de.clear().roundRect((t.renderer.width-L)/2,(t.renderer.height-C)/2,L,C,16).fill({color:2236996}),R.style.wordWrapWidth=t.renderer.width*.7,R.position.set(t.renderer.width/2,(t.renderer.height-C)/2+50),b.position.set(t.renderer.width/2,(t.renderer.height+C)/2-40),H.x=n/2-J/2-ye/2,H.y=ge,ie.x=n/2+J/2+ye/2,ie.y=ge,q.addChild(H,ie),Q(),ze(),I()}ae(),window.addEventListener("resize",ae)}Pe();
